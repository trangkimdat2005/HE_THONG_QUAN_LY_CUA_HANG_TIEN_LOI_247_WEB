@{
    ViewData["Title"] = "Trang chủ";
}

<main class="app-content">
    <div class="app-title">
        <div>
            <h1><i class="bi bi-speedometer"></i> Dashboard - Cửa Hàng Tiện Lợi 24/7</h1>
            <p>Tổng quan hoạt động kinh doanh</p>
        </div>
        <ul class="app-breadcrumb breadcrumb">
            <li class="breadcrumb-item"><i class="bi bi-house-door fs-6"></i></li>
            <li class="breadcrumb-item"><a asp-controller="HomeAdmin" asp-action="Index">Dashboard</a></li>
        </ul>
    </div>
    
    <!-- Thống kê tổng quan -->
    <div class="row">
        <div class="col-md-6 col-lg-3">
            <div class="widget-small primary coloured-icon">
                <i class="icon bi bi-people fs-1"></i>
                <div class="info">
                    <h4>Khách Hàng</h4>
                    <p><b>@ViewData["TongKhachHang"]</b></p>
                </div>
            </div>
        </div>
        <div class="col-md-6 col-lg-3">
            <div class="widget-small info coloured-icon">
                <i class="icon bi bi-person-badge fs-1"></i>
                <div class="info">
                    <h4>Nhân Viên</h4>
                    <p><b>@ViewData["TongNhanVien"]</b></p>
                </div>
            </div>
        </div>
        <div class="col-md-6 col-lg-3">
            <div class="widget-small warning coloured-icon">
                <i class="icon bi bi-box-seam fs-1"></i>
                <div class="info">
                    <h4>Sản Phẩm</h4>
                    <p><b>@ViewData["TongSanPham"]</b></p>
                </div>
            </div>
        </div>
        <div class="col-md-6 col-lg-3">
            <div class="widget-small danger coloured-icon">
                <i class="icon bi bi-receipt fs-1"></i>
                <div class="info">
                    <h4>Hóa Đơn</h4>
                    <p><b>@ViewData["TongHoaDon"]</b></p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Doanh thu -->
    <div class="row mt-3">
        <div class="col-md-4">
            <div class="tile">
                <div class="tile-title-w-btn">
                    <h3 class="title">Doanh Thu Hôm Nay</h3>
                </div>
                <div class="tile-body">
                    <h2 class="text-success fw-bold">@(((decimal)ViewData["DoanhThuHomNay"]).ToString("N0")) đ</h2>
                    <p class="text-muted">@DateTime.Now.ToString("dd/MM/yyyy")</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="tile">
                <div class="tile-title-w-btn">
                    <h3 class="title">Doanh Thu Tuần Này</h3>
                </div>
                <div class="tile-body">
                    <h2 class="text-primary fw-bold">@(((decimal)ViewData["DoanhThuTuan"]).ToString("N0")) đ</h2>
                    <p class="text-muted">7 ngày gần đây</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="tile">
                <div class="tile-title-w-btn">
                    <h3 class="title">Doanh Thu Tháng Này</h3>
                </div>
                <div class="tile-body">
                    <h2 class="text-info fw-bold">@(((decimal)ViewData["DoanhThuThang"]).ToString("N0")) đ</h2>
                    <p class="text-muted">Tháng @DateTime.Now.Month</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Biểu đồ và thống kê -->
    <div class="row">
        <div class="col-md-8">
            <div class="tile">
                <h3 class="tile-title">Doanh Thu 7 Ngày Gần Đây</h3>
                <div class="ratio ratio-16x9">
                    <div id="salesChart"></div>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="tile">
                <h3 class="tile-title">Top 5 Sản Phẩm Bán Chạy</h3>
                <div class="tile-body">
                    @{
                        var topSanPham = ViewData["TopSanPham"] as List<dynamic>;
                        if (topSanPham != null && topSanPham.Any())
                        {
                            <ul class="list-group">
                                @foreach (var sp in topSanPham)
                                {
                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                        <span>@sp.TenSP (@sp.DonVi)</span>
                                        <span class="badge bg-primary rounded-pill">@sp.SoLuong</span>
                                    </li>
                                }
                            </ul>
                        }
                        // else
                        // {
                        //     <p class="text-muted">Chưa có dữ liệu</p>
                        // }
                    }
                </div>
            </div>
        </div>
    </div>
    
    <!-- Sản phẩm sắp hết và đơn hàng -->
    <div class="row">
        <div class="col-md-6">
            <div class="tile">
                <h3 class="tile-title text-warning">
                    <i class="bi bi-exclamation-triangle"></i> Sản Phẩm Sắp Hết Hàng
                </h3>
                <div class="tile-body">
                    @{
                        var sanPhamSapHet = ViewData["SanPhamSapHet"] as List<dynamic>;
                        if (sanPhamSapHet != null && sanPhamSapHet.Any())
                        {
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>Sản Phẩm</th>
                                            <th>Đơn Vị</th>
                                            <th class="text-end">Tồn Kho</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var sp in sanPhamSapHet)
                                        {
                                            <tr class="@(sp.SoLuongTon < 5 ? "table-danger" : "table-warning")">
                                                <td>@sp.TenSP</td>
                                                <td>@sp.DonVi</td>
                                                <td class="text-end fw-bold">@sp.SoLuongTon</td>
                                            </tr>
                                        }
                                    </tbody>
                                </table>
                            </div>
                        }
                        else
                        {
                            <p class="text-success"><i class="bi bi-check-circle"></i> Tất cả sản phẩm đều còn đủ hàng</p>
                        }
                    }
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="tile">
                <h3 class="tile-title">
                    <i class="bi bi-clock-history"></i> Thông Tin Nhanh
                </h3>
                <div class="tile-body">
                    <div class="alert alert-info">
                        <strong>Đơn hàng chờ xử lý:</strong> @ViewData["DonChoXuLy"]
                    </div>
                    <div class="alert alert-success">
                        <strong>Tổng số sản phẩm:</strong> @ViewData["TongSanPham"]
                    </div>
                    <div class="alert alert-warning">
                        <strong>Tổng khách hàng:</strong> @ViewData["TongKhachHang"]
                    </div>
                    <div class="alert alert-primary">
                        <strong>Tổng nhân viên:</strong> @ViewData["TongNhanVien"]
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <script>
        // Dữ liệu doanh thu 7 ngày
        var doanhThuData = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(ViewData["DoanhThu7Ngay"]));
        
        var categories = doanhThuData.map(item => item.ngay);
        var data = doanhThuData.map(item => item.doanhThu);
        
        var options = {
            series: [{
                name: 'Doanh Thu',
                data: data
            }],
            chart: {
                type: 'area',
                height: '100%',
                toolbar: {
                    show: false
                }
            },
            dataLabels: {
                enabled: false
            },
            stroke: {
                curve: 'smooth',
                width: 2
            },
            xaxis: {
                categories: categories,
                title: {
                    text: 'Ngày'
                }
            },
            yaxis: {
                title: {
                    text: 'Doanh thu (VNĐ)'
                },
                labels: {
                    formatter: function(value) {
                        return value.toLocaleString('vi-VN');
                    }
                }
            },
            colors: ['#008FFB'],
            fill: {
                type: 'gradient',
                gradient: {
                    shadeIntensity: 1,
                    opacityFrom: 0.7,
                    opacityTo: 0.3,
                }
            },
            tooltip: {
                y: {
                    formatter: function(value) {
                        return value.toLocaleString('vi-VN') + ' đ';
                    }
                }
            }
        };

        var chart = new ApexCharts(document.querySelector("#salesChart"), options);
        chart.render();
    </script>
}