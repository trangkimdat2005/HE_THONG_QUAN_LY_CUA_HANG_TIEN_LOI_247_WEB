 @using HE_THONG_QUAN_LY_CUA_HANG_TIEN_LOI_247_WEB.Models.Entities;

@{

	ViewData["title"] = "Vị Trí Sản Phẩm";
}
<!-- Main sidebar ở đây nha -->





<main class="app-content">
	<div class="app-title">
		<div>
			<h1><i class="bi bi-pin-map"></i> Quản lý Vị trí</h1>
			<p>Quản lý vị trí sản phẩm và danh mục vị trí trong kho</p>
		</div>
		<ul class="app-breadcrumb breadcrumb side">
			<li class="breadcrumb-item"><i class="bi bi-house-door fs-6"></i></li>
			<li class="breadcrumb-item">Quản lý kho hàng</li>
			<li class="breadcrumb-item active"><a asp-controller="QuanLyKhoHang" asp-action="ViTriSanPham">Vị trí</a></li>
		</ul>
	</div>
	<!-- Danh sách vị trí sản phẩm-->
	<div class="row">
		<div class="col-md-12">
			<div class="tile">
				<div class="tile-title-w-btn d-flex justify-content-between align-items-center">
					<h3 class="title" style="margin-bottom: 0">Danh Sách Vị Trí Sản Phẩm</h3>
					<a class="btn btn-primary" asp-controller="Them" asp-action="ThemViTriSanPham"><i class="fas fa-plus"></i> Gán vị trí cho SP</a>
				</div>
				<div class="tile-body">
					<div class="table-responsive">
						<table class="table table-hover table-bordered" id="table-san-pham-vi-tri">
							<thead>
								<tr>
									<th>Tên Sản Phẩm</th>
									<th>Đơn vị tính</th>
									<th>Mã Vị Trí</th>
									<th>Loại Vị Trí</th>
									<th>Số Lượng</th>
									<th>Thao tác</th>
								</tr>
							</thead>
							<tbody>
								@{
									if (ViewData["lstSanPhamViTri"] != null)
									{
										List<SanPhamViTri> sanPhamViTris = ViewBag.lstSanPhamViTri;
										foreach (SanPhamViTri sanPhamViTri in sanPhamViTris)
										{
											<tr data-sanpham-id="@sanPhamViTri.SanPhamDonViId" data-vitri-id="@sanPhamViTri.ViTriId">
												<td>@sanPhamViTri.SanPhamDonVi.SanPham.Ten</td>
												<td>@sanPhamViTri.SanPhamDonVi.DonVi.Ten</td>
												<td>@sanPhamViTri.ViTri.MaViTri</td>
												<td>@sanPhamViTri.ViTri.LoaiViTri</td>
												<td>@sanPhamViTri.SoLuong</td>
												<td class="text-center">
													<button class="btn btn-info btn-sm me-1 btn-edit-sp-vt" title="Sửa"><i class="fas fa-edit"></i></button>
													<button class="btn btn-danger btn-sm btn-delete-sp-vt" title="Xóa"><i class="fas fa-trash-alt"></i></button>
												</td>
											</tr>
										}
									}
								}

							</tbody>
						</table>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- Danh mục vị trí -->
	<div class="row mt-4">
		<div class="col-md-12">
			<div class="tile">
				<div class="tile-title-w-btn d-flex justify-content-between align-items-center">
					<h3 class="title" style="margin-bottom: 0">Danh Mục Vị Trí (Kho/Kệ)</h3>
					<a class="btn btn-primary" asp-controller="Them" asp-action="ThemDanhMucViTRi"><i class="fas fa-plus"></i> Thêm vị trí mới</a>
				</div>
				<div class="tile-body">
					<div class="table-responsive">
						<table class="table table-hover table-bordered" id="table-danh-muc-vi-tri">
							<thead>
								<tr>
									<th>Mã Vị Trí</th>
									<th>Loại Vị Trí</th>
									<th>Mô Tả</th>
									<th class="text-center">Thao tác</th>
								</tr>
							</thead>
							<tbody>
								@{
									if (ViewData["lstSanPhamViTri"] != null)
									{
										List<SanPhamViTri> sanPhamViTris = ViewBag.lstSanPhamViTri;
										var uniqueViTris = sanPhamViTris
											.Select(spvt => spvt.ViTri)
											.Distinct()
											.ToList();
	
										foreach (var viTri in uniqueViTris)
										{
											<tr data-vitri-id="@viTri.Id">
												<td>@viTri.MaViTri</td>
												<td>@viTri.LoaiViTri</td>
												<td>@viTri.MoTa</td>
												<td class="text-center">
													<button class="btn btn-info btn-sm me-1 btn-edit-dm-vt" title="Sửa"><i class="fas fa-edit"></i></button>
													<button class="btn btn-danger btn-sm btn-delete-dm-vt" title="Xóa"><i class="fas fa-trash-alt"></i></button>
												</td>
											</tr>
										}
									}
								}

							</tbody>
						</table>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- Modal Sửa vị trí sản phẩm -->
	<div class="modal fade" id="modalSuaSanPhamViTri" tabindex="-1" aria-hidden="true">
		<div class="modal-dialog modal-lg modal-dialog-centered">
			<div class="modal-content">
				<div class="modal-header bg-info text-white">
					<h5 class="modal-title"><i class="bi bi-pencil-square me-2"></i>Điều Chuyển / Sửa Số Lượng SP</h5>
					<button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<div class="alert alert-info">Đang thao tác với SP: <strong id="sp-vt-ten">...</strong></div>
					<form id="formSuaSPVT">
						<div class="row g-3">
							<div class="col-md-6">
								<label class="form-label fw-bold">Vị trí hiện tại</label>
								<input type="text" class="form-control bg-light" id="sp-vt-ma-cu" readonly>
							</div>
							<div class="col-md-6">
								<label class="form-label fw-bold">Chuyển đến vị trí mới</label>
								<select class="form-select" id="sp-vt-ma-moi" required>
									@{
										var allViTris = ViewBag.lstSanPhamViTri != null 
											? ((List<SanPhamViTri>)ViewBag.lstSanPhamViTri)
												.Select(spvt => spvt.ViTri)
												.Distinct()
												.ToList()
											: new List<ViTri>();
	
										foreach (var vt in allViTris)
										{
											<option value="@vt.Id">@vt.MaViTri - @vt.LoaiViTri</option>
										}
									}
								</select>
							</div>
							<div class="col-md-6">
								<label class="form-label fw-bold">Số lượng</label>
								<input type="number" class="form-control" id="sp-vt-so-luong" min="1" required>
							</div>
						</div>
					</form>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
					<button type="button" class="btn btn-primary" id="btn-luu-sp-vt">Lưu thay đổi</button>
				</div>
			</div>
		</div>
	</div>
	<!-- Modal Sửa danh mục vị trí -->
	<div class="modal fade" id="modalSuaDanhMucViTri" tabindex="-1" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered">
			<div class="modal-content">
				<div class="modal-header bg-primary text-white">
					<h5 class="modal-title"><i class="fas fa-edit me-2"></i>Sửa Thông Tin Vị Trí (Kho/Kệ)</h5>
					<button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<form id="formSuaDMVT">
						<div class="mb-3">
							<label class="form-label fw-bold">Mã vị trí <span class="text-danger">*</span></label>
							<input type="text" class="form-control" id="dm-vt-ma" required>
						</div>
						<div class="mb-3">
							<label class="form-label fw-bold">Loại vị trí <span class="text-danger">*</span></label>
							<select class="form-select" id="dm-vt-loai" required>
								<option value="Kho">Kho</option>
								<option value="Trưng bày">Trưng bày</option>
								<option value="Kho lạnh">Kho lạnh</option>
							</select>
						</div>
						<div class="mb-3">
							<label class="form-label fw-bold">Mô tả</label>
							<textarea class="form-control" id="dm-vt-mo-ta" rows="3"></textarea>
						</div>
					</form>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
					<button type="button" class="btn btn-primary" id="btn-luu-dm-vt">Cập nhật vị trí</button>
				</div>
			</div>
		</div>
	</div>
</main>


<!-- js riêng ở đây nha! -->
<script src="~/assets/js/ViTriSanPham.js" asp-append-version="true" defer></script>

