@using HE_THONG_QUAN_LY_CUA_HANG_TIEN_LOI_247_WEB.Models.Entities;

@{
    ViewData["title"] = "Thêm Vị Trí Sản Phẩm";
    
    var danhSachNhanVien = ViewData["DanhSachNhanVien"] as List<NhanVien>;
    var danhSachSanPhamDonVi = ViewData["DanhSachSanPhamDonVi"] as List<SanPhamDonVi>;
    var danhSachViTri = ViewData["DanhSachViTri"] as List<ViTri>;
}

<!-- Css riêng ở đây nha -->
<link rel="stylesheet" href="~/assets/css/ThemViTriSanPham.css">
<link rel="stylesheet" href="~/assets/lib/select2/dist/css/select2.min.css">


<main class="app-content">
    <div class="app-title">
        <div>
            <h1><i class="bi bi-pin-map-fill"></i> Gán Vị Trí Sản Phẩm</h1>
            <p>Thiết lập và quản lý vị trí lưu trữ cho hàng hoá</p>
        </div>
        <ul class="app-breadcrumb breadcrumb">
            <li class="breadcrumb-item"><i class="bi bi-house-door fs-6"></i></li>
            <li class="breadcrumb-item">Quản lý kho hàng</li>
            <li class="breadcrumb-item"><a asp-controller="QuanLyKhoHang" asp-action="ViTriSanPham">Vị trí</a></li>
            <li class="breadcrumb-item active">Gán vị trí sản phẩm</li>
        </ul>
    </div>

    <div class="row">
        <div class="col-md-12">
            <div class="tile">


                <h4 class="tile-title text-primary border-bottom pb-2 mb-3">
                    <i class="bi bi-person-badge me-2"></i>Thông tin Phiếu Gán Vị Trí
                </h4>
                <div class="tile-body">
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <label class="form-label form-label-required fw-bold">
                                <i class="bi bi-person me-1"></i>Nhân viên thực hiện
                            </label>
                            <select class="form-control select2" id="select-nhan-vien" 
                                    data-placeholder="-- Chọn nhân viên --">
                                <option value="">-- Chọn nhân viên --</option>
                                @if (danhSachNhanVien != null && danhSachNhanVien.Any())
                                {
                                    foreach (var nv in danhSachNhanVien)
                                    {
                                        <option value="@nv.Id" data-chuc-vu="@nv.ChucVu">
                                            @nv.HoTen (@nv.ChucVu)
                                        </option>
                                    }
                                }
                            </select>
                            <small class="text-muted">
                                <i class="bi bi-info-circle"></i> Nhân viên có quyền gán vị trí
                            </small>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label form-label-required fw-bold">
                                <i class="bi bi-calendar-event me-1"></i>Ngày thực hiện
                            </label>
                            <input class="form-control" type="date" id="input-ngay-thuc-hien">
                            <small class="text-muted">
                                <i class="bi bi-info-circle"></i> Mặc định là ngày hôm nay
                            </small>
                        </div>
                    </div>

                    <h4 class="tile-title text-primary border-bottom pb-2 mb-3">
                        <i class="bi bi-box-seam me-2"></i>Chi Tiết Sản Phẩm & Vị Trí
                    </h4>

                    <div class="input-section">
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label class="form-label form-label-required fw-bold">
                                    <span class="badge bg-primary me-1">1</span>Chọn sản phẩm
                                </label>
                                <select class="form-control select2" id="select-san-pham"
                                        data-placeholder="-- Tìm kiếm sản phẩm --">
                                    <option value="">-- Tìm sản phẩm --</option>
                                    @if (danhSachSanPhamDonVi != null && danhSachSanPhamDonVi.Any())
                                    {
                                        foreach (var spdv in danhSachSanPhamDonVi)
                                        {
                                            var tenSanPham = spdv.SanPham?.Ten ?? "N/A";
                                            var donVi = spdv.DonVi?.Ten ?? "";
                                            var giaBan = spdv.GiaBan;
                                            var displayName = $"{tenSanPham} ({donVi})";
                                            <option value="@spdv.Id" 
                                                    data-name="@displayName" 
                                                    data-dvt="@donVi" 
                                                    data-price="@giaBan">
                                                @displayName - Mã: @spdv.Id
                                            </option>
                                        }
                                    }
                                </select>
                            </div>

                            <div class="col-md-3 mb-3">
                                <label class="form-label form-label-required fw-bold">
                                    <span class="badge bg-primary me-1">2</span>Mã vị trí
                                </label>
                                <select class="form-control select2" id="select-ma-vi-tri"
                                        data-placeholder="-- Chọn vị trí --">
                                    <option value="">-- Chọn vị trí --</option>
                                    @if (danhSachViTri != null && danhSachViTri.Any())
                                    {
                                        foreach (var vt in danhSachViTri)
                                        {
                                            <option value="@vt.Id" 
                                                    data-loai="@vt.LoaiViTri"
                                                    data-ma="@vt.MaViTri">
                                                @vt.MaViTri - @vt.LoaiViTri
                                            </option>
                                        }
                                    }
                                </select>
                            </div>

                            <div class="col-md-2 mb-3">
                                <label class="form-label fw-bold">
                                    <i class="bi bi-tag me-1"></i>Loại vị trí
                                </label>
                                <input class="form-control bg-light" type="text" id="input-loai-vi-tri" 
                                       readonly placeholder="Tự động">
                            </div>

                            <div class="col-md-2 mb-3">
                                <label class="form-label form-label-required fw-bold">
                                    <span class="badge bg-primary me-1">3</span>Số lượng
                                </label>
                                <input class="form-control" type="number" id="input-so-luong" 
                                       min="1" value="1" step="1">
                            </div>

                            <div class="col-md-1 mb-3 text-center">
                                <label class="form-label fw-bold d-block">&nbsp;</label>
                                <button class="btn btn-primary btn-action w-100" type="button" id="btn-them-dong"
                                        data-bs-toggle="tooltip" title="Thêm sản phẩm vào danh sách">
                                    <i class="bi bi-plus-circle-fill"></i>
                                </button>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-12">
                                <div class="alert alert-info mb-0">
                                    <i class="bi bi-lightbulb me-2"></i>
                                    <strong>Mẹo:</strong> Giá trị sản phẩm sẽ được tự động tính dựa trên giá bán × số lượng
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Table Section -->
                    <div class="card border-0 shadow-sm">
                        <div class="card-header bg-white">
                            <div class="row align-items-center">
                                <div class="col-md-6">
                                    <h5 class="mb-0">
                                        <i class="bi bi-list-ul me-2"></i>Danh Sách Sản Phẩm Đã Chọn
                                    </h5>
                                </div>
                                <div class="col-md-6 text-end">
                                    <button class="btn btn-sm btn-outline-danger" id="btn-clear-all"
                                            data-bs-toggle="tooltip" title="Xóa tất cả">
                                        <i class="bi bi-trash me-1"></i>Xóa tất cả

                                </div>
                            </div>
                        </div>
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table class="table table-hover table-bordered mb-0" id="table-gan-vi-tri">
                                    <thead class="table-light">
                                        <tr>
                                            <th class="c-stt">STT</th>
                                            <th class="c-ten text-start">Tên Sản Phẩm</th>
                                            <th class="c-dvt">ĐVT</th>
                                            <th class="c-ma">Mã Vị Trí</th>
                                            <th class="c-loai">Loại Vị Trí</th>
                                            <th class="c-sl">Số Lượng</th>
                                            <th class="c-gia text-end">Giá Trị</th>
                                            <th class="c-act"><i class="bi bi-gear-fill"></i></th>
                                        </tr>
                                    </thead>
                                    <tbody id="tbody-gan-vi-tri">
                                        <tr id="row-empty" data-placeholder="true">
                                            <td colspan="8" class="text-center text-muted py-5">
                                                <i class="bi bi-inbox" style="font-size: 3rem; opacity: 0.3;"></i>
                                                <p class="mt-2 mb-0">Chưa có sản phẩm nào</p>
                                                <small>Vui lòng thêm sản phẩm vào danh sách</small>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Footer Actions -->
                <div class="tile-footer">
                    <div class="row">
                        <div class="col-md-6">
                            <small class="text-muted">
                                <i class="bi bi-shield-check me-1"></i>
                                Dữ liệu sẽ được mã hóa và lưu trữ an toàn
                            </small>
                        </div>
                        <div class="col-md-6 text-end">
                            <a class="btn btn-secondary btn-action me-2" 
                               asp-controller="QuanLyKhoHang" 
                               asp-action="ViTriSanPham">
                                <i class="bi bi-x-circle me-2"></i>Hủy bỏ
                            </a>
                            <button class="btn btn-primary btn-action" type="button" id="btn-luu-phieu">
                                <i class="bi bi-floppy2-fill me-2"></i>Lưu hoàn tất
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>

<!-- js riêng ở đây nha! -->
<script src="~/assets/lib/select2/dist/js/select2.min.js" asp-append-version="true" defer></script>
<script src="~/assets/js/ThemViTriSanPham.js" asp-append-version="true" defer></script>

